<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAP-Salesforce Integration | Forged Technologies</title>
    <meta name="description" content="Real-time customer master synchronization between SAP ECC and Salesforce CRM with OAuth 2.0, external ID upsert, and complete audit logging.">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css?v=2">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23181818' rx='8' width='100' height='100'/><path d='M25 18h50v14H39v12h30v14H39v24H25V18z' fill='%23909090'/></svg>">
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="container nav__container">
            <a href="../index.html" class="nav__logo">Forged</a>

            <button class="nav__toggle" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>

            <ul class="nav__links">
                <li><a href="../index.html" class="nav__link">Home</a></li>
                <li><a href="../solutions.html" class="nav__link nav__link--active">Solutions</a></li>
                <li><a href="../enterprise-security.html" class="nav__link">Security</a></li>
                <li><a href="../about.html" class="nav__link">About</a></li>
                <li><a href="../contact.html" class="nav__cta">Let's Talk</a></li>
            </ul>
        </div>
    </nav>

    <!-- Solution Hero -->
    <section class="solution-hero">
        <div class="container container--narrow">
            <a href="../solutions.html" style="font-size: 0.875rem; color: var(--text-muted); display: inline-flex; align-items: center; gap: 0.5rem; margin-bottom: var(--space-lg);">
                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                Back to Solutions
            </a>

            <h1>SAP-Salesforce Customer Master Integration</h1>
            <p class="mt-md" style="font-size: 1.125rem; max-width: 600px;">
                Real-time customer master synchronization between SAP ECC and Salesforce CRM
                with OAuth 2.0 authentication, external ID-based operations, and complete audit trail.
            </p>

            <div class="solution-hero__meta mt-lg">
                <span><strong>Timeline:</strong> 2 weeks</span>
                <span><strong>Platform:</strong> SAP ECC / Salesforce</span>
                <span><strong>Role:</strong> Solo architect & developer</span>
            </div>
        </div>
    </section>

    <!-- Stats -->
    <section style="padding: var(--space-2xl) 0; background: var(--bg-secondary);">
        <div class="container container--narrow">
            <div class="stats-grid">
                <div class="stat">
                    <span class="stat__number">2</span>
                    <span class="stat__label">Database Tables</span>
                </div>
                <div class="stat">
                    <span class="stat__number">1</span>
                    <span class="stat__label">API Class</span>
                </div>
                <div class="stat">
                    <span class="stat__number">1</span>
                    <span class="stat__label">BADI Hook</span>
                </div>
                <div class="stat">
                    <span class="stat__number">Real-time</span>
                    <span class="stat__label">Sync Speed</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Solution Content -->
    <section class="solution-content">
        <div class="container container--narrow">

            <!-- The Problem -->
            <div class="solution-section">
                <h2>The Problem</h2>
                <p>
                    Sales teams live in Salesforce. Operations teams live in SAP. When customer data
                    exists in both systems without synchronization, problems compound quickly.
                </p>
                <p>The typical pain points:</p>
                <ul>
                    <li><strong>Manual data entry</strong> — Same customer information keyed twice, in two systems</li>
                    <li><strong>Data inconsistencies</strong> — Address changes in SAP never reach Salesforce (or vice versa)</li>
                    <li><strong>Delayed CRM updates</strong> — Sales reps working with stale customer information</li>
                    <li><strong>No audit trail</strong> — When data differs, no way to know which system was right</li>
                    <li><strong>Compliance gaps</strong> — Customer consent and contact preferences out of sync</li>
                </ul>
            </div>

            <!-- The Solution -->
            <div class="solution-section">
                <h2>The Solution</h2>
                <p>
                    A lightweight integration that synchronizes customer master data from SAP ECC to
                    Salesforce in real-time, triggered automatically when customers are created or modified.
                </p>

                <h3>Core Capabilities</h3>
                <ul>
                    <li><strong>OAuth 2.0 Authentication</strong> — Secure token-based authentication with automatic refresh handling</li>
                    <li><strong>Real-time Synchronization</strong> — Customer changes propagate immediately via BADI trigger</li>
                    <li><strong>External ID Upsert</strong> — Uses SAP customer number as Salesforce external ID for idempotent operations</li>
                    <li><strong>Non-blocking Design</strong> — Integration failures don't interrupt SAP transactions</li>
                    <li><strong>Complete Audit Trail</strong> — Every sync attempt logged with request/response details</li>
                    <li><strong>Field Mapping</strong> — Configurable mapping between SAP and Salesforce field structures</li>
                </ul>
            </div>

            <!-- Architecture -->
            <div class="solution-section">
                <h2>Architecture</h2>
                <p>
                    The integration follows a simple, maintainable pattern: SAP business events trigger
                    API calls to Salesforce, with the integration layer handling authentication, data
                    transformation, and error logging.
                </p>

                <!-- SAP-Salesforce Architecture Diagram -->
                <div class="flow-diagram" style="padding: var(--space-2xl);">
                    <div class="flow-diagram__title">SAP-Salesforce Integration Architecture</div>

                    <svg width="100%" height="280" viewBox="0 0 700 280" fill="none" style="max-width: 700px; margin: 0 auto; display: block;">
                        <!-- SAP Layer -->
                        <rect x="20" y="30" width="180" height="220" rx="8" fill="rgba(64,64,64,0.12)" stroke="rgba(64,64,64,0.4)" stroke-width="1"/>
                        <text x="110" y="55" fill="#606060" font-size="11" font-weight="600" text-anchor="middle" letter-spacing="1">SAP ECC</text>

                        <!-- Customer Master Transaction -->
                        <rect x="35" y="75" width="150" height="50" rx="6" fill="#353535" stroke="#505050" stroke-width="1.5"/>
                        <text x="110" y="97" fill="#e0e0e0" font-size="12" font-weight="500" text-anchor="middle">Customer Master</text>
                        <text x="110" y="115" fill="#707070" font-size="10" text-anchor="middle">XD01 / XD02 / VD01</text>

                        <!-- BADI Trigger -->
                        <rect x="35" y="140" width="150" height="40" rx="6" fill="#404040" stroke="#707070" stroke-width="1.5"/>
                        <text x="110" y="165" fill="#909090" font-size="11" font-weight="500" text-anchor="middle">BADI Trigger</text>

                        <!-- Database -->
                        <rect x="35" y="195" width="150" height="40" rx="6" fill="#2a2a2a" stroke="#404040" stroke-width="1"/>
                        <text x="110" y="220" fill="#606060" font-size="10" text-anchor="middle">Config + Audit Log</text>

                        <!-- Arrow: Customer to BADI -->
                        <line x1="110" y1="125" x2="110" y2="140" stroke="#606060" stroke-width="1.5"/>

                        <!-- Integration Layer (Highlighted) -->
                        <rect x="235" y="70" width="160" height="130" rx="8" fill="rgba(144,144,144,0.12)" stroke="#909090" stroke-width="2"/>
                        <text x="315" y="95" fill="#909090" font-size="10" font-weight="600" text-anchor="middle" letter-spacing="1">INTEGRATION LAYER</text>

                        <!-- OAuth Component -->
                        <rect x="250" y="110" width="55" height="30" rx="4" fill="#909090"/>
                        <text x="277" y="130" fill="#0a0a0a" font-size="10" font-weight="600" text-anchor="middle">OAuth</text>

                        <!-- API Client -->
                        <rect x="315" y="110" width="65" height="30" rx="4" fill="#909090"/>
                        <text x="347" y="130" fill="#0a0a0a" font-size="10" font-weight="600" text-anchor="middle">API Client</text>

                        <!-- JSON Transform -->
                        <rect x="250" y="150" width="130" height="30" rx="4" fill="#707070"/>
                        <text x="315" y="170" fill="#e0e0e0" font-size="10" font-weight="500" text-anchor="middle">JSON Transform</text>

                        <!-- Arrow: SAP to Integration -->
                        <line x1="185" y1="135" x2="230" y2="135" stroke="#707070" stroke-width="2"/>
                        <polygon points="228,130 238,135 228,140" fill="#707070"/>

                        <!-- Salesforce Layer -->
                        <rect x="430" y="30" width="180" height="220" rx="8" fill="rgba(96,96,96,0.1)" stroke="rgba(96,96,96,0.3)" stroke-width="1"/>
                        <text x="520" y="55" fill="#606060" font-size="11" font-weight="600" text-anchor="middle" letter-spacing="1">SALESFORCE</text>

                        <!-- REST API -->
                        <rect x="445" y="75" width="150" height="40" rx="6" fill="#404040" stroke="#909090" stroke-width="1.5"/>
                        <text x="520" y="100" fill="#e0e0e0" font-size="11" font-weight="500" text-anchor="middle">REST API</text>

                        <!-- Account Object -->
                        <rect x="445" y="130" width="150" height="50" rx="6" fill="#353535" stroke="#505050" stroke-width="1"/>
                        <text x="520" y="152" fill="#e0e0e0" font-size="12" font-weight="500" text-anchor="middle">Account Object</text>
                        <text x="520" y="170" fill="#707070" font-size="10" text-anchor="middle">External ID Upsert</text>

                        <!-- Contact Object -->
                        <rect x="445" y="195" width="150" height="40" rx="6" fill="#2a2a2a" stroke="#404040" stroke-width="1"/>
                        <text x="520" y="220" fill="#606060" font-size="10" text-anchor="middle">Contact Object</text>

                        <!-- Arrow: REST to Account -->
                        <line x1="520" y1="115" x2="520" y2="130" stroke="#505050" stroke-width="1.5"/>

                        <!-- Arrow: Integration to Salesforce -->
                        <line x1="395" y1="135" x2="440" y2="135" stroke="#707070" stroke-width="2"/>
                        <polygon points="438,130 448,135 438,140" fill="#707070"/>

                        <!-- Bidirectional indicator text -->
                        <text x="315" y="260" fill="#505050" font-size="9" text-anchor="middle">SAP Customer Number = Salesforce External ID</text>
                    </svg>
                </div>

                <h3>Integration Flow</h3>
                <div class="code-block">
<pre>1. User creates/updates customer in SAP (XD01/XD02)
2. BADI intercepts the save event
3. Integration class retrieves OAuth token
4. Customer data mapped to Salesforce JSON structure
5. REST API call to Salesforce (upsert by External ID)
6. Response logged to audit table
7. SAP transaction completes (non-blocking)</pre>
                </div>
            </div>

            <!-- Technical Highlights -->
            <div class="solution-section">
                <h2>Technical Highlights</h2>

                <h3>OAuth 2.0 Token Management</h3>
                <p>
                    Secure authentication using Salesforce Connected App with automatic token lifecycle:
                </p>
                <ul>
                    <li>Initial authentication via username-password flow or JWT bearer</li>
                    <li>Token stored securely with expiration tracking</li>
                    <li>Automatic refresh before expiration</li>
                    <li>Graceful handling of token revocation</li>
                </ul>

                <h3>External ID Pattern</h3>
                <p>
                    The integration uses SAP customer number as the Salesforce external ID, enabling
                    idempotent upsert operations:
                </p>
                <ul>
                    <li>New customer in SAP creates new Account in Salesforce</li>
                    <li>Existing customer update overwrites the matching Account</li>
                    <li>No duplicate records, no manual matching required</li>
                    <li>Reliable even with retry scenarios</li>
                </ul>

                <h3>Non-blocking Architecture</h3>
                <p>
                    Critical design decision: Salesforce sync failures never block SAP transactions.
                </p>
                <ul>
                    <li>API calls wrapped in exception handling</li>
                    <li>Failures logged but don't raise SAP errors</li>
                    <li>Retry mechanism for transient failures</li>
                    <li>Daily reconciliation report identifies gaps</li>
                </ul>

                <h3>Audit & Monitoring</h3>
                <p>
                    Complete visibility into every synchronization attempt:
                </p>
                <ul>
                    <li>Request timestamp and user</li>
                    <li>SAP customer number and Salesforce Account ID</li>
                    <li>HTTP status code and response body</li>
                    <li>Success/failure flag with error details</li>
                </ul>
            </div>

            <!-- Security Architecture -->
            <div class="solution-section">
                <h2>Security Architecture</h2>
                <p>
                    Customer master data requires secure handling. This integration implements
                    enterprise-grade security across all touchpoints.
                </p>

                <div class="security-highlights-grid">
                    <div class="security-highlight">
                        <div class="security-highlight__icon">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
                            </svg>
                        </div>
                        <div class="security-highlight__content">
                            <strong>OAuth 2.0 / JWT Bearer Flow</strong>
                            <p>Server-to-server authentication using Salesforce Connected App. JWT Bearer flow for automated operations without user credentials in transit.</p>
                        </div>
                    </div>

                    <div class="security-highlight">
                        <div class="security-highlight__icon">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                            </svg>
                        </div>
                        <div class="security-highlight__content">
                            <strong>External ID Pattern</strong>
                            <p>Idempotent upsert operations ensure reliable data sync without duplicates. SAP customer number serves as immutable external identifier in Salesforce.</p>
                        </div>
                    </div>

                    <div class="security-highlight">
                        <div class="security-highlight__icon">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                        </div>
                        <div class="security-highlight__content">
                            <strong>Complete Audit Logging</strong>
                            <p>Every API call logged with timestamp, SAP user, customer number, Salesforce ID, HTTP status, and response details. Full traceability for compliance.</p>
                        </div>
                    </div>

                    <div class="security-highlight">
                        <div class="security-highlight__icon">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                        </div>
                        <div class="security-highlight__content">
                            <strong>API Limit Awareness</strong>
                            <p>Built-in awareness of Salesforce API limits (115K daily). Bulk API 2.0 ready for high-volume scenarios exceeding 2K records per batch.</p>
                        </div>
                    </div>
                </div>

                <p style="margin-top: var(--space-lg);">
                    <a href="../enterprise-security.html" style="color: var(--accent-primary);">Learn more about our security architecture →</a>
                </p>
            </div>

            <!-- Business Application -->
            <div class="solution-section">
                <h2>Business Application</h2>
                <p>
                    The integration was deployed for customer master synchronization with the following workflow:
                </p>
                <ol style="list-style: decimal; padding-left: var(--space-xl); color: var(--text-secondary);">
                    <li style="margin-bottom: var(--space-sm);">Sales rep requests new customer setup</li>
                    <li style="margin-bottom: var(--space-sm);">Master data team creates customer in SAP (XD01)</li>
                    <li style="margin-bottom: var(--space-sm);">BADI triggers automatic Salesforce sync</li>
                    <li style="margin-bottom: var(--space-sm);">Account created in Salesforce with SAP customer number as external ID</li>
                    <li style="margin-bottom: var(--space-sm);">Sales rep sees new account in Salesforce within seconds</li>
                    <li style="margin-bottom: var(--space-sm);">Future updates in SAP automatically sync to Salesforce</li>
                </ol>
            </div>

            <!-- Results -->
            <div class="solution-section">
                <h2>Results</h2>
                <ul>
                    <li><strong>Eliminated manual data entry</strong> — No more duplicate entry in Salesforce</li>
                    <li><strong>Real-time data availability</strong> — Sales reps see new customers immediately</li>
                    <li><strong>Complete audit trail</strong> — Every sync logged for compliance</li>
                    <li><strong>Zero operational disruption</strong> — Non-blocking design protects SAP transactions</li>
                    <li><strong>Maintainable codebase</strong> — Clean separation of concerns enables future extensions</li>
                </ul>
            </div>

            <!-- Documentation Delivered -->
            <div class="solution-section">
                <h2>Documentation Delivered</h2>
                <p>
                    This project included comprehensive documentation for deployment, maintenance,
                    and future development.
                </p>

                <div class="documentation-highlights">
                    <div class="doc-highlight">
                        <div class="doc-highlight__icon">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                            </svg>
                        </div>
                        <div class="doc-highlight__content">
                            <strong>Architecture Documentation</strong>
                            <span>Integration design, component relationships, data flows</span>
                        </div>
                    </div>

                    <div class="doc-highlight">
                        <div class="doc-highlight__icon">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                        </div>
                        <div class="doc-highlight__content">
                            <strong>API Reference</strong>
                            <span>Methods, parameters, return types, and usage examples</span>
                        </div>
                    </div>

                    <div class="doc-highlight">
                        <div class="doc-highlight__icon">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                            </svg>
                        </div>
                        <div class="doc-highlight__content">
                            <strong>Setup & Configuration Guide</strong>
                            <span>Step-by-step deployment and Salesforce Connected App setup</span>
                        </div>
                    </div>

                    <div class="doc-highlight">
                        <div class="doc-highlight__icon">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                            </svg>
                        </div>
                        <div class="doc-highlight__content">
                            <strong>Troubleshooting Guide</strong>
                            <span>Common issues, error codes, and resolution procedures</span>
                        </div>
                    </div>
                </div>

                <!-- Architecture Documentation Dropdown -->
                <div class="doc-preview" id="arch-doc-preview">
                    <button class="doc-preview__toggle" onclick="toggleArchDoc()">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M9 5l7 7-7 7"/>
                        </svg>
                        View Architecture Documentation Highlights
                    </button>
                    <div class="doc-preview__content">
                        <!-- Tab Navigation -->
                        <div class="arch-doc-tabs">
                            <button class="arch-doc-tabs__btn active" onclick="showArchTab('quick-ref')">Quick Reference</button>
                            <button class="arch-doc-tabs__btn" onclick="showArchTab('flow')">Integration Flow</button>
                            <button class="arch-doc-tabs__btn" onclick="showArchTab('mapping')">Field Mapping</button>
                            <button class="arch-doc-tabs__btn" onclick="showArchTab('config')">Configuration</button>
                            <button class="arch-doc-tabs__btn" onclick="showArchTab('troubleshoot')">Troubleshooting</button>
                            <button class="arch-doc-tabs__btn" onclick="showArchTab('transactions')">SAP Transactions</button>
                        </div>

                        <!-- Tab 1: Quick Reference -->
                        <div class="arch-doc-section active" id="arch-tab-quick-ref">
                            <h4>Quick Reference</h4>
                            <table class="sap-table">
                                <thead>
                                    <tr>
                                        <th>Capability</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>OAuth 2.0</code></td>
                                        <td>Username-Password flow with automatic token caching and refresh</td>
                                    </tr>
                                    <tr>
                                        <td><code>Upsert Operations</code></td>
                                        <td>Create or update Salesforce records using External ID pattern</td>
                                    </tr>
                                    <tr>
                                        <td><code>Real-time Sync</code></td>
                                        <td>BADI-triggered synchronization on customer save events</td>
                                    </tr>
                                    <tr>
                                        <td><code>Transaction Logging</code></td>
                                        <td>Complete audit trail with request/response payloads</td>
                                    </tr>
                                    <tr>
                                        <td><code>Error Resilience</code></td>
                                        <td>Auto-retry on token expiration, non-blocking error handling</td>
                                    </tr>
                                </tbody>
                            </table>

                            <h5>Core Components</h5>
                            <ul>
                                <li><strong>API Client Class</strong> — Salesforce REST API client class (OAuth, upsert, logging)</li>
                                <li><strong>Customer Sync BADI</strong> — BADI implementation triggering sync on save</li>
                                <li><strong>Config Table</strong> — OAuth credentials and API configuration table</li>
                                <li><strong>Log Table</strong> — Transaction audit log with full request/response</li>
                            </ul>
                        </div>

                        <!-- Tab 2: Integration Flow -->
                        <div class="arch-doc-section" id="arch-tab-flow">
                            <h4>Integration Flow</h4>
                            <p>When a customer is saved in SAP, the following sequence executes:</p>

                            <div class="arch-doc-flow">
                                <div class="arch-doc-flow__step">
                                    <span class="arch-doc-flow__num">1</span>
                                    <span>User saves customer in SAP (XD01/XD02/VD01)</span>
                                </div>
                                <div class="arch-doc-flow__step">
                                    <span class="arch-doc-flow__num">2</span>
                                    <span>BADI triggers Customer Sync BADI implementation</span>
                                </div>
                                <div class="arch-doc-flow__step">
                                    <span class="arch-doc-flow__num">3</span>
                                    <span>API Client Class loads OAuth credentials from Config Table</span>
                                </div>
                                <div class="arch-doc-flow__step">
                                    <span class="arch-doc-flow__num">4</span>
                                    <span>If token expired or missing, request new token from Salesforce</span>
                                </div>
                                <div class="arch-doc-flow__step">
                                    <span class="arch-doc-flow__num">5</span>
                                    <span>Build JSON payload from KNA1 fields (with escaping)</span>
                                </div>
                                <div class="arch-doc-flow__step">
                                    <span class="arch-doc-flow__num">6</span>
                                    <span>PATCH to Salesforce: <code>/sobjects/Account/SAP_Customer_Number__c/{kunnr}</code></span>
                                </div>
                                <div class="arch-doc-flow__step">
                                    <span class="arch-doc-flow__num">7</span>
                                    <span>Log result to Log Table (success or error — never blocks save)</span>
                                </div>
                            </div>

                            <div class="arch-doc-callout">
                                <div class="arch-doc-callout__title">Token Refresh Logic</div>
                                <div class="arch-doc-callout__content">
                                    If API returns HTTP 401, the system automatically refreshes the token and retries once.
                                    Tokens are cached in both memory and database (Config Table) and valid for ~2 hours.
                                </div>
                            </div>
                        </div>

                        <!-- Tab 3: Field Mapping -->
                        <div class="arch-doc-section" id="arch-tab-mapping">
                            <h4>Field Mapping Reference</h4>
                            <p>KNA1 (SAP Customer Master) → Salesforce Account object:</p>

                            <table class="sap-table">
                                <thead>
                                    <tr>
                                        <th>SAP Field</th>
                                        <th>Salesforce Field</th>
                                        <th>Transformation</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>KUNNR</code></td>
                                        <td><code>SAP_Customer_Number__c</code></td>
                                        <td>ALPHA conversion (leading zeros)</td>
                                    </tr>
                                    <tr>
                                        <td><code>NAME1</code></td>
                                        <td><code>Name</code></td>
                                        <td>JSON escape: <code>"</code> and <code>\</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>STRAS</code></td>
                                        <td><code>BillingStreet</code></td>
                                        <td>JSON escape: <code>"</code> and <code>\</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>ORT01</code></td>
                                        <td><code>BillingCity</code></td>
                                        <td>JSON escape: <code>"</code> only</td>
                                    </tr>
                                    <tr>
                                        <td><code>REGIO</code></td>
                                        <td><code>BillingState</code></td>
                                        <td>Direct copy</td>
                                    </tr>
                                    <tr>
                                        <td><code>PSTLZ</code></td>
                                        <td><code>BillingPostalCode</code></td>
                                        <td>Direct copy</td>
                                    </tr>
                                    <tr>
                                        <td><code>LAND1</code></td>
                                        <td><code>BillingCountry</code></td>
                                        <td>Direct copy</td>
                                    </tr>
                                    <tr>
                                        <td><code>TELF1</code></td>
                                        <td><code>Phone</code></td>
                                        <td>Direct copy</td>
                                    </tr>
                                </tbody>
                            </table>

                            <div class="arch-doc-callout">
                                <div class="arch-doc-callout__title">External ID Pattern</div>
                                <div class="arch-doc-callout__content">
                                    SAP_Customer_Number__c is configured as an External ID (unique) in Salesforce.
                                    This enables idempotent upsert operations — the same request can be sent multiple
                                    times without creating duplicates.
                                </div>
                            </div>
                        </div>

                        <!-- Tab 4: Configuration Checklist -->
                        <div class="arch-doc-section" id="arch-tab-config">
                            <h4>Configuration Checklist</h4>

                            <h5>Salesforce Setup</h5>
                            <ul class="arch-doc-checklist">
                                <li>Security Token obtained from user settings (Setup → My Personal Information)</li>
                                <li>Connected App created with OAuth Username-Password flow enabled</li>
                                <li>Connected App activated (wait 10 minutes after creation)</li>
                                <li><code>SAP_Customer_Number__c</code> custom field on Account (Text 10, External ID, Unique)</li>
                                <li>API user has "API Enabled" permission and Account object access</li>
                            </ul>

                            <h5>SAP Setup</h5>
                            <ul class="arch-doc-checklist">
                                <li>Config Table created (SE11) and activated</li>
                                <li>Log Table created (SE11) and activated</li>
                                <li>API Client Class created (SE24) and activated</li>
                                <li>Customer Sync BADI class created and activated</li>
                                <li>BADI implementation created (SE19) and set to Active</li>
                                <li>SSL certificates imported (STRUST) for login.salesforce.com and *.my.salesforce.com</li>
                                <li>Credentials entered via SM30 → Config Table (password = password+security_token)</li>
                            </ul>

                            <h5>Verification Tests</h5>
                            <ul class="arch-doc-checklist">
                                <li>Connection Test Program → Token test passes</li>
                                <li>Connection Test Program → Customer upsert test passes</li>
                                <li>XD01 customer save triggers Salesforce sync</li>
                                <li>Account appears in Salesforce with correct External ID</li>
                            </ul>
                        </div>

                        <!-- Tab 5: Troubleshooting -->
                        <div class="arch-doc-section" id="arch-tab-troubleshoot">
                            <h4>Troubleshooting Guide</h4>

                            <h5>Diagnostic Decision Tree</h5>
                            <div class="arch-doc-flow">
                                <div class="arch-doc-flow__step">
                                    <span class="arch-doc-flow__num">?</span>
                                    <span><strong>No Log Table entries?</strong> → BADI not triggering. Check SE19 activation.</span>
                                </div>
                                <div class="arch-doc-flow__step">
                                    <span class="arch-doc-flow__num">?</span>
                                    <span><strong>AUTH ERROR status?</strong> → Token problem. Check credentials in SM30.</span>
                                </div>
                                <div class="arch-doc-flow__step">
                                    <span class="arch-doc-flow__num">?</span>
                                    <span><strong>SAP2SF ERROR status?</strong> → API problem. Check External ID field and permissions.</span>
                                </div>
                            </div>

                            <h5>Common OAuth Errors</h5>
                            <table class="sap-table">
                                <thead>
                                    <tr>
                                        <th>Error</th>
                                        <th>Cause</th>
                                        <th>Solution</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>invalid_grant</code></td>
                                        <td>Wrong password or security token</td>
                                        <td>Verify password+security_token concatenation</td>
                                    </tr>
                                    <tr>
                                        <td><code>invalid_client_id</code></td>
                                        <td>Wrong Consumer Key</td>
                                        <td>Check Config Table CONSUMER_KEY field</td>
                                    </tr>
                                    <tr>
                                        <td><code>inactive_user</code></td>
                                        <td>Salesforce user deactivated</td>
                                        <td>Reactivate user in Salesforce</td>
                                    </tr>
                                </tbody>
                            </table>

                            <h5>Common API Errors</h5>
                            <table class="sap-table">
                                <thead>
                                    <tr>
                                        <th>Error</th>
                                        <th>HTTP</th>
                                        <th>Solution</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>INVALID_FIELD</code></td>
                                        <td>400</td>
                                        <td>Verify SAP_Customer_Number__c field exists on Account</td>
                                    </tr>
                                    <tr>
                                        <td><code>INSUFFICIENT_ACCESS</code></td>
                                        <td>403</td>
                                        <td>Check API user permissions on Account object</td>
                                    </tr>
                                    <tr>
                                        <td><code>STRING_TOO_LONG</code></td>
                                        <td>400</td>
                                        <td>Truncate SAP data before sync</td>
                                    </tr>
                                </tbody>
                            </table>

                            <div class="arch-doc-callout">
                                <div class="arch-doc-callout__title">Emergency Disable</div>
                                <div class="arch-doc-callout__content">
                                    If integration is causing issues: <strong>SE19 → BADI Enhancement Implementation → Deactivate</strong>.
                                    This allows customer saves to continue without Salesforce sync. Re-sync manually later via Connection Test Program.
                                </div>
                            </div>
                        </div>

                        <!-- Tab 6: SAP Transactions -->
                        <div class="arch-doc-section" id="arch-tab-transactions">
                            <h4>SAP Transaction Reference</h4>
                            <table class="sap-table">
                                <thead>
                                    <tr>
                                        <th>Transaction</th>
                                        <th>Object</th>
                                        <th>Purpose</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>SE11</code></td>
                                        <td>Config Table, Log Table</td>
                                        <td>Data dictionary — create/view tables</td>
                                    </tr>
                                    <tr>
                                        <td><code>SE24</code></td>
                                        <td>API Client Class, BADI Classes</td>
                                        <td>Class builder — create/maintain ABAP classes</td>
                                    </tr>
                                    <tr>
                                        <td><code>SE19</code></td>
                                        <td>BADI Implementation</td>
                                        <td>Create and activate BADI implementation</td>
                                    </tr>
                                    <tr>
                                        <td><code>SM30</code></td>
                                        <td>Config Table</td>
                                        <td>Table maintenance — enter OAuth credentials</td>
                                    </tr>
                                    <tr>
                                        <td><code>SE38</code></td>
                                        <td>Test Programs, Log Programs</td>
                                        <td>Program execution — test and monitor</td>
                                    </tr>
                                    <tr>
                                        <td><code>STRUST</code></td>
                                        <td>SSL Certificates</td>
                                        <td>Import Salesforce SSL certificates</td>
                                    </tr>
                                </tbody>
                            </table>

                            <div class="arch-doc-callout">
                                <div class="arch-doc-callout__title">Deployment Order</div>
                                <div class="arch-doc-callout__content">
                                    1. SE11 (tables) → 2. SE24 (classes) → 3. SE19 (BADI) → 4. STRUST (certs) → 5. SM30 (credentials) → 6. SE38 (test)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                function toggleArchDoc() {
                    const preview = document.getElementById('arch-doc-preview');
                    preview.classList.toggle('expanded');
                }

                function showArchTab(tabId) {
                    // Hide all sections
                    document.querySelectorAll('.arch-doc-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    // Remove active from all buttons
                    document.querySelectorAll('.arch-doc-tabs__btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    // Show selected section
                    document.getElementById('arch-tab-' + tabId).classList.add('active');
                    // Set button active
                    event.target.classList.add('active');
                }
                </script>
            </div>

            <!-- Technologies -->
            <div class="solution-section">
                <h2>Technologies</h2>
                <div class="card__tags" style="gap: var(--space-md);">
                    <span class="tag" style="font-size: 0.875rem; padding: var(--space-sm) var(--space-md);">SAP ECC</span>
                    <span class="tag" style="font-size: 0.875rem; padding: var(--space-sm) var(--space-md);">ABAP</span>
                    <span class="tag" style="font-size: 0.875rem; padding: var(--space-sm) var(--space-md);">Salesforce REST API</span>
                    <span class="tag" style="font-size: 0.875rem; padding: var(--space-sm) var(--space-md);">OAuth 2.0</span>
                    <span class="tag" style="font-size: 0.875rem; padding: var(--space-sm) var(--space-md);">JSON</span>
                    <span class="tag" style="font-size: 0.875rem; padding: var(--space-sm) var(--space-md);">BADIs</span>
                </div>
            </div>

            <!-- CTA -->
            <div style="margin-top: var(--space-3xl); padding: var(--space-2xl); background: var(--bg-secondary); border-radius: 12px; text-align: center;">
                <h3 style="margin-bottom: var(--space-md);">Need a similar integration?</h3>
                <p style="margin-bottom: var(--space-xl); max-width: 500px; margin-left: auto; margin-right: auto;">
                    We build SAP integrations with Salesforce, ServiceNow, DocuSign, and other
                    cloud platforms. Let's talk about your requirements.
                </p>
                <a href="../contact.html" class="btn btn--primary btn--large">Start a Conversation</a>
            </div>

        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container footer__content">
            <p class="footer__text">&copy; 2026 Forged Technologies. Built with focus.</p>
            <ul class="footer__links">
                <li><a href="https://www.linkedin.com/in/nathan-murray-311266114/" class="footer__link" target="_blank" rel="noopener">LinkedIn</a></li>
                <li><a href="https://github.com/natem1095" class="footer__link" target="_blank" rel="noopener">GitHub</a></li>
                <li><a href="mailto:nate@forgedintegration.com" class="footer__link">Email</a></li>
            </ul>
        </div>
    </footer>

    <script src="../js/main.js"></script>
</body>
</html>
